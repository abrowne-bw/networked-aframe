!function(t){function e(u){if(n[u])return n[u].exports;var o=n[u]={exports:{},id:u,loaded:!1};return t[u].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";n(12),n(11),n(1),n(61),n(63),n(60),n(62)},function(t,e,n){"use strict";var u=n(53),o=n(55),i=n(54),r=n(52),s=n(59),a=n(58),c=n(57),D={};D.app="",D.room="",D.clientId="",D.options=u,D.utils=o,D.physics=i,D.log=new r,D.schemas=new s,D.version="0.2.0";var l=new a,h=new c(l);D.connection=D.c=h,D.entities=D.e=l,t.exports=window.NAF=D},function(t,e){"use strict";var n=Array.prototype.forEach,u=Object.create;t.exports=function(t){var e=u(null);return n.call(arguments,function(t){e[t]=!0}),e}},function(t,e){"use strict";t.exports=function(t){if(null==t)throw new TypeError("Cannot use null or undefined");return t}},function(t,e,n){"use strict";function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var u=e[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}return function(e,n,u){return n&&t(e.prototype,n),u&&t(e,u),e}}(),s=n(51),a=function(t){function e(){u(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.connectList={},t.dcIsActive={},t.networkEntities={},t}return i(e,t),r(e,[{key:"joinRoom",value:function(t){this.notImplemented()}},{key:"setStreamOptions",value:function(t){this.notImplemented()}},{key:"setDatachannelListeners",value:function(t,e,n){this.notImplemented()}},{key:"setRoomOccupantListener",value:function(t){this.notImplemented()}},{key:"setLoginListeners",value:function(t,e){this.notImplemented()}},{key:"connect",value:function(t){this.notImplemented()}},{key:"shouldStartConnectionTo",value:function(){this.notImplemented()}},{key:"startStreamConnection",value:function(t){this.notImplemented()}},{key:"closeStreamConnection",value:function(t){this.notImplemented()}},{key:"sendData",value:function(t,e,n){this.notImplemented()}},{key:"sendDataGuaranteed",value:function(t,e,n){this.notImplemented()}},{key:"getConnectStatus",value:function(t){this.notImplemented()}}]),e}(s);a.IS_CONNECTED="IS_CONNECTED",a.CONNECTING="CONNECTING",a.NOT_CONNECTED="NOT_CONNECTED",t.exports=a},function(t,e,n){"use strict";t.exports=n(15)()?Array.from:n(16)},function(t,e,n){"use strict";var u,o=n(25),i=n(8),r=n(28),s=n(32);u=t.exports=function(t,e){var n,u,r,a,c;return arguments.length<2||"string"!=typeof t?(a=e,e=t,t=null):a=arguments[2],null==t?(n=r=!0,u=!1):(n=s.call(t,"c"),u=s.call(t,"e"),r=s.call(t,"w")),c={value:e,configurable:n,enumerable:u,writable:r},a?o(i(a),c):c},u.gs=function(t,e,n){var u,a,c,D;return"string"!=typeof t?(c=n,n=e,e=t,t=null):c=arguments[3],null==e?e=void 0:r(e)?null==n?n=void 0:r(n)||(c=n,n=void 0):(c=e,e=n=void 0),null==t?(u=!0,a=!1):(u=s.call(t,"c"),a=s.call(t,"e")),D={get:e,set:n,configurable:u,enumerable:a},c?o(i(c),D):D}},function(t,e,n){"use strict";function u(t){return null===t||void 0===t}function o(t){return!(!t||"object"!==("undefined"==typeof t?"undefined":r(t))||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0]))}function i(t,e,n){var i,l;if(u(t)||u(e))return!1;if(t.prototype!==e.prototype)return!1;if(c(t))return!!c(e)&&(t=s.call(t),e=s.call(e),D(t,e,n));if(o(t)){if(!o(e))return!1;if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}try{var h=a(t),p=a(e)}catch(t){return!1}if(h.length!=p.length)return!1;for(h.sort(),p.sort(),i=h.length-1;i>=0;i--)if(h[i]!=p[i])return!1;for(i=h.length-1;i>=0;i--)if(l=h[i],!D(t[l],e[l],n))return!1;return("undefined"==typeof t?"undefined":r(t))===("undefined"==typeof e?"undefined":r(e))}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=Array.prototype.slice,a=n(14),c=n(13),D=t.exports=function(t,e,n){return n||(n={}),t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!t||!e||"object"!=("undefined"==typeof t?"undefined":r(t))&&"object"!=("undefined"==typeof e?"undefined":r(e))?n.strict?t===e:t==e:i(t,e,n))}},function(t,e){"use strict";var n=Array.prototype.forEach,u=Object.create,o=function(t,e){var n;for(n in t)e[n]=t[n]};t.exports=function(t){var e=u(null);return n.call(arguments,function(t){null!=t&&o(Object(t),e)}),e}},function(t,e){"use strict";t.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},function(t,e,n){"use strict";var u=n(5),o=n(2);t.exports=o.apply(null,u("\n\r\u2028\u2029"))},function(t,e){"use strict";if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");var n=THREE.Math.degToRad;AFRAME.registerComponent("lerp",{schema:{duration:{type:"int",default:100},properties:{default:["position","rotation","scale"]}},init:function(){this.lerpingPosition=!1,this.lerpingRotation=!1,this.lerpingScale=!1,this.el.addEventListener("componentchanged",this.changedListener.bind(this))},tick:function(t,e){var n,u=this.now(),o=this.el.object3D;this.lerpingPosition&&(n=(u-this.startLerpTimePosition)/this.data.duration,o.position.lerpVectors(this.startPosition,this.targetPosition,n),n>=1&&(this.lerpingPosition=!1)),this.lerpingRotation&&(n=(u-this.startLerpTimeRotation)/this.data.duration,THREE.Quaternion.slerp(this.startRotation,this.targetRotation,o.quaternion,n),n>=1&&(this.lerpingRotation=!1)),this.lerpingScale&&(n=(u-this.startLerpTimeScale)/this.data.duration,o.scale.lerpVectors(this.startScale,this.targetScale,n),n>=1&&(this.lerpingScale=!1))},changedListener:function(t){var e=t.detail.name,n=t.detail.oldData,u=t.detail.newData;this.data.properties.indexOf(e)!=-1&&("position"==e?this.toPosition(n,u):"rotation"==e?this.toRotation(n,u):"scale"==e&&this.toScale(n,u))},toPosition:function(t,e){this.lerpingPosition=!0,this.startLerpTimePosition=this.now(),this.startPosition=new THREE.Vector3(t.x,t.y,t.z),this.targetPosition=new THREE.Vector3(e.x,e.y,e.z)},toRotation:function(t,e){this.lerpingRotation=!0,this.startLerpTimeRotation=this.now(),this.startRotation=new THREE.Quaternion,this.startRotation.setFromEuler(new THREE.Euler(n(t.x),n(t.y),n(t.z),"YXZ")),this.targetRotation=new THREE.Quaternion,this.targetRotation.setFromEuler(new THREE.Euler(n(e.x),n(e.y),n(e.z),"YXZ"))},toScale:function(t,e){this.lerpingScale=!0,this.startLerpTimeScale=this.now(),this.startScale=new THREE.Vector3(t.x,t.y,t.z),this.targetScale=new THREE.Vector3(e.x,e.y,e.z)},now:function(){return Date.now()}})},function(t,e,n){"use strict";function u(t,e,n){return new Promise(function(u){l(e).then(function(){f[t]={template:s(e)(n.trim()),type:e},u(f[t])})})}function o(t,e,n){switch(e){case E:return t(n);case F:return t(n);case A:return Mustache.render(t,n);case m:return t.render(n);default:return h(t,n)}}function i(t,e){var n=document.querySelector(t),o=n.getAttribute("type"),i=n.innerHTML;if(!e){if(!o)throw new Error("Must provide `type` attribute for <script> templates (e.g., handlebars, jade, nunjucks, html)");if(o.indexOf("handlebars")!==-1)e=E;else if(o.indexOf("jade")!==-1)e=F;else if(o.indexOf("mustache")!==-1)e=A;else if(o.indexOf("nunjucks")!==-1)e=m;else{if(o.indexOf("html")===-1)return void C("Template type could not be inferred from the script tag. Please add a type.");e=v}}return new Promise(function(n){u(t,e,i).then(function(t){n(t,e)})})}function r(t,e){return new Promise(function(n){var o;o=new XMLHttpRequest,o.addEventListener("load",function(){u(t,e,o.response).then(function(t){n(t,e)})}),o.open("GET",t),o.send()})}function s(t){switch(t){case E:return a;case F:return c;case A:return a;case m:return D;default:return function(t){return t}}}function a(t){return Handlebars.compile(t)}function c(t){return jade.compile(t)}function D(t){return nunjucks.compile(t)}function l(t){return new Promise(function(e){if(!t||"html"===t)return e();var n=w[t];if(w[t]===!0)return e();n||(n=document.createElement("script"),w[t]=n,n.setAttribute("src",b[t]),y('Lazy-loading %s engine. Please add <script src="%s"> to your page.',t,b[t]),document.body.appendChild(n));var u=n.onload||function(){};n.onload=function(){u(),w[t]=!0,e()}})}var h=n(42),p=AFRAME.utils.debug,d=AFRAME.utils.extend,f={},C=p("template-component:error"),y=p("template-component:info"),E="handlebars",F="jade",A="mustache",m="nunjucks",v="html",w={};w[E]=!!window.Handlebars,w[F]=!!window.jade,w[A]=!!window.Mustache,w[m]=!!window.nunjucks;var b={};b[E]="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js",b[F]="https://cdnjs.cloudflare.com/ajax/libs/jade/1.11.0/jade.min.js",b[A]="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.2.1/mustache.min.js",b[m]="https://cdnjs.cloudflare.com/ajax/libs/nunjucks/2.3.0/nunjucks.min.js",AFRAME.registerComponent("template",{schema:{insert:{default:"beforeend"},type:{default:""},src:{default:""},data:{default:""}},update:function(t){var e=this.data,n=this.el,u="#"===e.src[0]?i:r,o=f[e.src];if(t&&t.src!==e.src)for(;n.firstChild;)n.removeChild(n.firstChild);return o?void this.renderTemplate(o):void u(e.src,e.type).then(this.renderTemplate.bind(this))},renderTemplate:function(t){var e=this.el,n=this.data,u={};Object.keys(e.dataset).forEach(function(t){u[t]=e.dataset[t]}),n.data&&(u=d(u,e.getAttribute(n.data)));var i=o(t.template,t.type,u);e.insertAdjacentHTML(n.insert,i),e.emit("templaterendered")}}),AFRAME.registerComponent("template-set",{schema:{on:{type:"string"},src:{type:"string"},data:{type:"string"}},init:function(){var t=this.data,e=this.el;e.addEventListener(t.on,function(){e.setAttribute("template",{src:t.src,data:t.data})})}})},function(t,e){"use strict";function n(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function u(t){return t&&"object"==("undefined"==typeof t?"undefined":o(t))&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();e=t.exports=i?n:u,e.supported=n,e.unsupported=u},function(t,e){"use strict";function n(t){var e=[];for(var n in t)e.push(n);return e}e=t.exports="function"==typeof Object.keys?Object.keys:n,e.shim=n},function(t,e){"use strict";t.exports=function(){var t,e,n=Array.from;return"function"==typeof n&&(t=["raz","dwa"],e=n(t),Boolean(e&&e!==t&&"dwa"===e[1]))}},function(t,e,n){"use strict";var u=n(36).iterator,o=n(17),i=n(18),r=n(24),s=n(9),a=n(3),c=n(35),D=Array.isArray,l=Function.prototype.call,h={configurable:!0,enumerable:!0,writable:!0,value:null},p=Object.defineProperty;t.exports=function(t){var e,n,d,f,C,y,E,F,A,m,v=arguments[1],w=arguments[2];if(t=Object(a(t)),null!=v&&s(v),this&&this!==Array&&i(this))e=this;else{if(!v){if(o(t))return C=t.length,1!==C?Array.apply(null,t):(f=new Array(1),f[0]=t[0],f);if(D(t)){for(f=new Array(C=t.length),n=0;n<C;++n)f[n]=t[n];return f}}f=[]}if(!D(t))if(void 0!==(A=t[u])){for(E=s(A).call(t),e&&(f=new e),F=E.next(),n=0;!F.done;)m=v?l.call(v,w,F.value,n):F.value,e?(h.value=m,p(f,n,h)):f[n]=m,F=E.next(),++n;C=n}else if(c(t)){for(C=t.length,e&&(f=new e),n=0,d=0;n<C;++n)m=t[n],n+1<C&&(y=m.charCodeAt(0),y>=55296&&y<=56319&&(m+=t[++n])),m=v?l.call(v,w,m,d):m,e?(h.value=m,p(f,d,h)):f[d]=m,++d;C=d}if(void 0===C)for(C=r(t.length),e&&(f=new e(C)),n=0;n<C;++n)m=v?l.call(v,w,t[n],n):t[n],e?(h.value=m,p(f,n,h)):f[n]=m;return e&&(h.value=null,f.length=C),f}},function(t,e){"use strict";var n=Object.prototype.toString,u=n.call(function(){return arguments}());t.exports=function(t){return n.call(t)===u}},function(t,e,n){"use strict";var u=Object.prototype.toString,o=u.call(n(19));t.exports=function(t){return"function"==typeof t&&u.call(t)===o}},function(t,e){"use strict";t.exports=function(){}},function(t,e,n){"use strict";t.exports=n(21)()?Math.sign:n(22)},function(t,e){"use strict";t.exports=function(){var t=Math.sign;return"function"==typeof t&&(1===t(10)&&t(-20)===-1)}},function(t,e){"use strict";t.exports=function(t){return t=Number(t),isNaN(t)||0===t?t:t>0?1:-1}},function(t,e,n){"use strict";var u=n(20),o=Math.abs,i=Math.floor;t.exports=function(t){return isNaN(t)?0:(t=Number(t),0!==t&&isFinite(t)?u(t)*i(o(t)):t)}},function(t,e,n){"use strict";var u=n(23),o=Math.max;t.exports=function(t){return o(0,u(t))}},function(t,e,n){"use strict";t.exports=n(26)()?Object.assign:n(27)},function(t,e){"use strict";t.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(t={foo:"raz"},e(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},function(t,e,n){"use strict";var u=n(29),o=n(3),i=Math.max;t.exports=function(t,e){var n,r,s,a=i(arguments.length,2);for(t=Object(o(t)),s=function(u){try{t[u]=e[u]}catch(t){n||(n=t)}},r=1;r<a;++r)e=arguments[r],u(e).forEach(s);if(void 0!==n)throw n;return t}},function(t,e){"use strict";t.exports=function(t){return"function"==typeof t}},function(t,e,n){"use strict";t.exports=n(30)()?Object.keys:n(31)},function(t,e){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},function(t,e){"use strict";var n=Object.keys;t.exports=function(t){return n(null==t?t:Object(t))}},function(t,e,n){"use strict";t.exports=n(33)()?String.prototype.contains:n(34)},function(t,e){"use strict";var n="razdwatrzy";t.exports=function(){return"function"==typeof n.contains&&(n.contains("dwa")===!0&&n.contains("foo")===!1)}},function(t,e){"use strict";var n=String.prototype.indexOf;t.exports=function(t){return n.call(this,t,arguments[1])>-1}},function(t,e){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=Object.prototype.toString,o=u.call("");t.exports=function(t){return"string"==typeof t||t&&"object"===("undefined"==typeof t?"undefined":n(t))&&(t instanceof String||u.call(t)===o)||!1}},function(t,e,n){"use strict";t.exports=n(37)()?Symbol:n(39)},function(t,e){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u={object:!0,symbol:!0};t.exports=function(){var t;if("function"!=typeof Symbol)return!1;t=Symbol("test symbol");try{String(t)}catch(t){return!1}return!!u[n(Symbol.iterator)]&&(!!u[n(Symbol.toPrimitive)]&&!!u[n(Symbol.toStringTag)])}},function(t,e){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t){return!!t&&("symbol"===("undefined"==typeof t?"undefined":n(t))||!!t.constructor&&("Symbol"===t.constructor.name&&"Symbol"===t[t.constructor.toStringTag]))}},function(t,e,n){"use strict";var u,o,i,r,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=n(6),c=n(40),D=Object.create,l=Object.defineProperties,h=Object.defineProperty,p=Object.prototype,d=D(null);if("function"==typeof Symbol){u=Symbol;try{String(u()),r=!0}catch(t){}}var f=function(){var t=D(null);return function(e){for(var n,u,o=0;t[e+(o||"")];)++o;return e+=o||"",t[e]=!0,n="@@"+e,h(p,n,a.gs(null,function(t){u||(u=!0,h(this,n,a(t)),u=!1)})),n}}();i=function(t){if(this instanceof i)throw new TypeError("Symbol is not a constructor");return o(t)},t.exports=o=function t(e){var n;if(this instanceof t)throw new TypeError("Symbol is not a constructor");return r?u(e):(n=D(i.prototype),e=void 0===e?"":String(e),l(n,{__description__:a("",e),__name__:a("",f(e))}))},l(o,{for:a(function(t){return d[t]?d[t]:d[t]=o(String(t))}),keyFor:a(function(t){var e;c(t);for(e in d)if(d[e]===t)return e}),hasInstance:a("",u&&u.hasInstance||o("hasInstance")),isConcatSpreadable:a("",u&&u.isConcatSpreadable||o("isConcatSpreadable")),iterator:a("",u&&u.iterator||o("iterator")),match:a("",u&&u.match||o("match")),replace:a("",u&&u.replace||o("replace")),search:a("",u&&u.search||o("search")),species:a("",u&&u.species||o("species")),split:a("",u&&u.split||o("split")),toPrimitive:a("",u&&u.toPrimitive||o("toPrimitive")),toStringTag:a("",u&&u.toStringTag||o("toStringTag")),unscopables:a("",u&&u.unscopables||o("unscopables"))}),l(i.prototype,{constructor:a(o),toString:a("",function(){return this.__name__})}),l(o.prototype,{toString:a(function(){return"Symbol ("+c(this).__description__+")"}),valueOf:a(function(){return c(this)})}),h(o.prototype,o.toPrimitive,a("",function(){var t=c(this);return"symbol"===("undefined"==typeof t?"undefined":s(t))?t:t.toString()})),h(o.prototype,o.toStringTag,a("c","Symbol")),h(i.prototype,o.toStringTag,a("c",o.prototype[o.toStringTag])),h(i.prototype,o.toPrimitive,a("c",o.prototype[o.toPrimitive]))},function(t,e,n){"use strict";var u=n(38);t.exports=function(t){if(!u(t))throw new TypeError(t+" is not a symbol");return t}},function(t,e,n){"use strict";var u,o,i,r,s,a,c,D,l,h,p=n(46);s=function(t){return"\\"===t?a:"$"===t?c:(o+=t,s)},a=function(t){return"\\"!==t&&"$"!==t&&(o+="\\"),o+=t,s},c=function(t){return"{"===t?(i.push(o),o="",D):"$"===t?(o+="$",c):(o+="$"+t,s)},D=function(t){var e,n=h.slice(u);return p(n,"}",function(t){return p.nest>=0?p.next():void(e=t)}),null!=e?(r.push(h.slice(u,u+e)),u+=e,o="",s):(e=n.length,u+=e,o+=n,D)},l=function(t){return"\\"!==t&&"}"!==t&&(o+="\\"),o+=t,D},t.exports=function(t){var e,n,p;for(o="",i=[],r=[],h=String(t),e=h.length,n=s,u=0;u<e;++u)n=n(h[u]);return n===s?i.push(o):n===a?i.push(o+"\\"):n===c?i.push(o+"$"):n===D?i[i.length-1]+="${"+o:n===l&&(i[i.length-1]+="${"+o+"\\"),p={literals:i,substitutions:r},i=r=null,p}},function(t,e,n){"use strict";var u=n(41),o=n(44);t.exports=function(t,e){return o(u(t),e,arguments[2])}},function(t,e){"use strict";var n=Array.prototype.reduce;t.exports=function(t){var e=arguments;return n.call(t,function(t,n,u){return t+(void 0===e[u]?"":String(e[u]))+n})}},function(t,e,n){"use strict";var u=n(45),o=n(43);t.exports=function(t,e){return o.apply(null,u(t,e,arguments[2]))}},function(t,e,n){"use strict";var u=n(3),o=n(8),i=n(47),r=Array.prototype.map,s=Object.keys,a=JSON.stringify;t.exports=function(t,e){var n,c,D,l=Object(arguments[2]);return u(t)&&u(t.literals)&&u(t.substitutions),e=o(e),n=s(e).filter(i),c=n.join(", "),D=n.map(function(t){return e[t]}),[t.literals].concat(r.call(t.substitutions,function(t){var e;if(t){try{e=new Function(c,"return ("+t+")")}catch(e){throw new TypeError("Unable to compile expression:\n\targs: "+a(c)+"\n\tbody: "+a(t)+"\n\terror: "+e.stack)}try{return e.apply(null,D)}catch(e){if(l.partial)return"${"+t+"}";throw new TypeError("Unable to resolve expression:\n\targs: "+a(c)+"\n\tbody: "+a(t)+"\n\terror: "+e.stack)}}}))}},function(t,e,n){"use strict";var u,o,i,r,s,a,c,D,l,h,p,d,f,C,y,E,F,A,m,v,w,b,g,k,B,S,O,T=n(5),N=n(2),P=n(3),x=n(9),L=n(6),R=n(10),I=n(49),j=Object.prototype.hasOwnProperty,_=N.apply(null,T(";{=([,<>+-*/%&|^!~?:}")),U=N.apply(null,T(";{=([,<>+-*/%&|^!~?:})]."));u=function(t){if(d&&!(p>=t))for(;p!==t;){if(!d)return;j.call(I,d)?j.call(R,d)&&(C=p,++f):E=d,d=v[++p]}},o=function(t){null!=B&&A.push([S,B,t]),S={point:p+1,line:f,column:p+1-C},B=p},i=function(){var t;return S.raw=v.slice(B,p),m.push(S),A.length?(t=A.pop(),S=t[0],B=t[1],void(O=t[2])):(S=null,B=null,void(O=null))},r=function(){var t=O;return O=F,++F,u(p+1),o(t),s},a=function(){if("'"===d||'"'===d)return k=d,d=v[++p],c;if("("===d||"{"===d||"["===d)++F;else if(")"===d||"}"===d||"]"===d)O===--F&&i();else if("/"===d&&j.call(_,E))return d=v[++p],h;return d!==w||!b&&E&&!y&&!j.call(U,E)?(E=d,d=v[++p],s):g(p,E,F)},D=function(){for(;;){if(!d)return;if(j.call(R,d))return C=p+1,void++f;d=v[++p]}},l=function(){for(;;){if(!d)return;if("*"!==d)j.call(R,d)&&(C=p+1,++f),d=v[++p];else if(d=v[++p],"/"===d)return}},s=function(){var t;for(y=!1;;){if(!d)return;if(j.call(I,d))y=!0,j.call(R,d)&&(C=p+1,++f);else{if("/"!==d)break;if(t=v[p+1],"/"===t)d=v[p+=2],y=!0,D();else{if("*"!==t)break;d=v[p+=2],y=!0,l()}}d=v[++p]}return a},c=function(){for(;;){if(!d)return;if(d===k)return d=v[++p],E=k,s;"\\"===d&&j.call(R,v[++p])&&(C=p+1,++f),d=v[++p]}},h=function(){for(;;){if(!d)return;if("/"===d)return E="/",d=v[++p],s;"\\"===d&&++p,d=v[++p]}},t.exports=e=function(t){function e(e,n,u){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,n,u){var o;if(v=String(P(t)),w=String(P(n)),1!==w.length)throw new TypeError(w+" should be one character long string");for(g=x(u),b=j.call(U,w),p=0,d=v[p],f=1,C=0,y=!1,E=null,F=0,A=[],m=[],e.forceStop=!1,o=s;o;)o=o();return m}),Object.defineProperties(e,{$ws:L(s),$common:L(a),collectNest:L(r),move:L(u),index:L.gs(function(){return p}),line:L.gs(function(){return f}),nest:L.gs(function(){return F}),columnIndex:L.gs(function(){return C}),next:L(function(t){if(d)return u(p+(t||1)),s()}),resume:L(function(){return a})})},function(t,e){"use strict";t.exports=RegExp.prototype.test.bind(/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|null|this|true|void|with|await|break|catch|class|const|false|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D])(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF])*$/);
},function(t,e,n){"use strict";var u=n(5),o=n(2);t.exports=o.apply(null,u(" \f\t\v​  ​᠎ ​  ​  ​  ​  ​  ​​​  ​　"))},function(t,e,n){"use strict";var u=n(2),o=n(10),i=n(48);t.exports=u.apply(null,Object.keys(o).concat(Object.keys(i)))},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var u=e[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}return function(e,n,u){return n&&t(e.prototype,n),u&&t(e,u),e}}(),o=function(){function t(){n(this,t),this.dict={}}return u(t,[{key:"addChild",value:function(t,e){this.hasParent(t)||(this.dict[t]=[]),this.dict[t].push(e)}},{key:"getChildren",value:function(t){if(!this.hasParent(t))return[];var e=this.dict[t];return delete this.dict[t],e}},{key:"hasParent",value:function(t){return this.dict.hasOwnProperty(t)}}]),t}();t.exports=o},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var u=e[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}return function(e,n,u){return n&&t(e.prototype,n),u&&t(e,u),e}}(),o=function(){function t(){n(this,t)}return u(t,[{key:"notImplemented",value:function(){console.error("Interface method not implemented.")}}]),t}();t.exports=o},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var u=e[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}return function(e,n,u){return n&&t(e.prototype,n),u&&t(e,u),e}}(),o=function(){function t(){n(this,t),this.debug=!1}return u(t,[{key:"setDebug",value:function(t){this.debug=t}},{key:"write",value:function(){this.debug&&console.log.apply(this,arguments)}},{key:"error",value:function(){console.error.apply(this,arguments)}}]),t}();t.exports=o},function(t,e){"use strict";var n={debug:!1,updateRate:15,compressSyncPackets:!1,useLerp:!0};t.exports=n},function(t,e){"use strict";t.exports.getPhysicsData=function(t){if(t.body){var e=NAF.physics.getConstraints(t),n={type:t.body.type,hasConstraint:null!=e&&e.length>0,position:t.body.position,quaternion:t.body.quaternion,velocity:t.body.velocity,angularVelocity:t.body.angularVelocity,timestamp:NAF.utils.now()};return n}return null},t.exports.getConstraints=function(t){if(!t.sceneEl.systems.physics||!t.body)return null;var e=t.sceneEl.systems.physics.world.constraints,n=[];if(!(e&&e.length>0))return null;for(var u=0;u<e.length;u++)e[u].bodyA.id!=t.body.id&&e[u].bodyB.id!=t.body.id||n.push(e[u]);return n},t.exports.updatePhysics=function(t,e){var n=NAF.physics.getEntityBody(t);n&&""!=e&&(n.position.copy(e.position),n.quaternion.copy(e.quaternion),n.velocity.copy(e.velocity),n.angularVelocity.copy(e.angularVelocity))},t.exports.isStrongerThan=function(t,e){return!(!t.body||!e)&&NAF.physics.calculatePhysicsStrength(t.body)>NAF.physics.calculatePhysicsStrength(e)},t.exports.calculatePhysicsStrength=function(t){var e=Math.abs(t.velocity.x)+Math.abs(t.velocity.y)+Math.abs(t.velocity.z),n=Math.abs(t.angularVelocity.x)+Math.abs(t.angularVelocity.y)+Math.abs(t.angularVelocity.z);return 2*e+n},t.exports.attachPhysicsLerp=function(t,e){t&&e&&AFRAME.utils.entity.setComponentProperty(t,"physics-lerp",{targetPosition:e.position,targetQuaternion:e.quaternion,targetVelocity:e.velocity,targetAngularVelocity:e.angularVelocity,time:1e3/NAF.options.updateRate})},t.exports.detachPhysicsLerp=function(t){t&&t.components["physics-lerp"]&&t.removeAttribute("physics-lerp")},t.exports.sleep=function(t){if(t){var e=NAF.physics.getEntityBody(t);e&&e.sleep()}},t.exports.wakeUp=function(t){if(t){var e=NAF.physics.getEntityBody(t);e&&e.sleepState==CANNON.Body.SLEEPING&&e.wakeUp()}},t.exports.getEntityBody=function(t){if(t.body)return t.body;var e=t.querySelector("[dynamic-body], [static-body]");return e&&e.body?e.body:null},t.exports.collisionEvent="collide",t.exports.getDataFromCollision=function(t){if(t)return{body:t.detail.body,el:t.detail.body.el}}},function(t,e){"use strict";t.exports.whenEntityLoaded=function(t,e){t.hasLoaded&&e(),t.addEventListener("loaded",function(){e()})},t.exports.createHtmlNodeFromString=function(t){var e=document.createElement("div");e.innerHTML=t;var n=e.firstChild;return n},t.exports.getNetworkOwner=function(t){var e=t.components;return e.hasOwnProperty("networked-remote")?t.components["networked-remote"].data.owner:e.hasOwnProperty("networked")?t.components.networked.owner:null},t.exports.getNetworkId=function(t){var e=t.components;return e.hasOwnProperty("networked-remote")?t.components["networked-remote"].data.networkId:e.hasOwnProperty("networked-share")?t.components.networked.data.networkId:e.hasOwnProperty("networked")?t.components.networked.networkId:null},t.exports.getNetworkType=function(t){var e=t.components;return e.hasOwnProperty("networked-remote")?"networked-remote":e.hasOwnProperty("networked-share")?"networked-share":e.hasOwnProperty("networked")?"networked":null},t.exports.now=function(){return Date.now()},t.exports.delimiter="---",t.exports.childSchemaToKey=function(e){return(e.selector||"")+t.exports.delimiter+e.component+t.exports.delimiter+(e.property||"")},t.exports.keyToChildSchema=function(e){var n=e.split(t.exports.delimiter,3);return{selector:n[0]||void 0,component:n[1],property:n[2]||void 0}},t.exports.isChildSchemaKey=function(e){return e.indexOf(t.exports.delimiter)!=-1},t.exports.childSchemaEqual=function(t,e){return t.selector==e.selector&&t.component==e.component&&t.property==e.property}},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var u=e[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}return function(e,n,u){return n&&t(e.prototype,n),u&&t(e,u),e}}(),o=function(){function t(e,u){n(this,t),this.el=e,this.data=u,this.cachedData={},this.initNetworkId(),this.initNetworkParent(),this.registerEntity(this.networkId)}return u(t,[{key:"setData",value:function(t){this.data=t}},{key:"initNetworkId",value:function(){this.networkId=this.data.networkId?this.data.networkId:this.createNetworkId()}},{key:"createNetworkId",value:function(){return Math.random().toString(36).substring(2,9)}},{key:"initNetworkParent",value:function(){var t=this.el.parentElement;t.hasOwnProperty("components")&&t.components.hasOwnProperty("networked")?this.parent=t:this.parent=null}},{key:"registerEntity",value:function(t){naf.entities.registerLocalEntity(t,this.el)}},{key:"listenForLoggedIn",value:function(){document.body.addEventListener("loggedIn",this.onLoggedIn.bind(this),!1)}},{key:"checkLoggedIn",value:function(){naf.clientId?this.onLoggedIn():this.listenForLoggedIn()}},{key:"onLoggedIn",value:function(){this.owner=this.data.owner||""==this.data.owner?this.data.owner:naf.clientId,this.syncAll()}},{key:"setOwner",value:function(t){this.owner=t}},{key:"isMine",value:function(){return naf.connection.isMineAndConnected(this.owner)}},{key:"syncAll",value:function(){this.updateNextSyncTime();var t=this.getAllSyncedComponents(),e=this.getComponentsData(t),n=this.createSyncData(e);naf.connection.broadcastDataGuaranteed("u",n),this.updateCache(e)}},{key:"syncDirty",value:function(){this.updateNextSyncTime();var t=this.getDirtyComponents();if(0!=t.length||this.data.physics){var e=this.getComponentsData(t),n=this.createSyncData(e);naf.options.compressSyncPackets&&(n=this.compressSyncData(n)),naf.connection.broadcastData("u",n),this.updateCache(e)}}},{key:"needsToSync",value:function(){return naf.utils.now()>=this.nextSyncTime}},{key:"updateNextSyncTime",value:function(){this.nextSyncTime=naf.utils.now()+1e3/naf.options.updateRate}},{key:"getComponentsData",value:function(t){var e=this.el.components,n={};for(var u in t){var o=t[u];if("string"==typeof o){if(e.hasOwnProperty(o)){var i=o,r=e[i];n[i]=r.getData()}}else{var s=naf.utils.childSchemaToKey(o),a=this.el.querySelector(o.selector);if(a){var c=a.components[o.component];if(c){var D=o.property?c.data[o.property]:c.getData();n[s]=D}else naf.log.write("Could not find component "+o.component+" on child ",a,a.components)}}}return n}},{key:"getDirtyComponents",value:function(){var t=this.el.components,e=this.getAllSyncedComponents(),n=[];for(var u in e){var o,i,r=e[u],s="string"==typeof r;if(s){var a=t.hasOwnProperty(r);if(!a)continue;o=r,i=t[r].getData()}else{var c=r.selector,D=r.component,l=r.property,h=this.el.querySelector(c),a=h&&h.components.hasOwnProperty(D);if(!a)continue;o=naf.utils.childSchemaToKey(r),i=h.components[D].getData(),l&&(i=i[l])}var p=this.cachedData.hasOwnProperty(o);if(p){var d=this.cachedData[o];deepEqual(d,i)||n.push(r)}else n.push(r)}return n}},{key:"createSyncData",value:function(t){var e={0:0,networkId:this.networkId,owner:this.owner,takeover:this.takeover,template:this.data.template,showTemplate:this.data.showRemoteTemplate,parent:this.getParentId(),components:t};return this.data.physics&&(e.physics=NAF.physics.getPhysicsData(this.el)),e}},{key:"getParentId",value:function(){if(this.initNetworkParent(),null==this.parent)return null;var t=this.parent.components.networked;return t.networkId}},{key:"getAllSyncedComponents",value:function(){return this.data.components?this.data.components:naf.schemas.getComponents(this.data.template)}},{key:"networkUpdateHandler",value:function(t){var e=t.detail.entityData;this.networkUpdate(e)}},{key:"networkUpdate",value:function(t){1==t[0]&&(t=this.decompressSyncData(t)),t.physics&&this.updatePhysics(t.physics),this.updateComponents(t.components)}},{key:"updateComponents",value:function(t){for(var e in t)if(this.isSyncableComponent(e)){var n=t[e];if(naf.utils.isChildSchemaKey(e)){var u=naf.utils.keyToChildSchema(e),o=this.el.querySelector(u.selector);o&&(u.property?o.setAttribute(u.component,u.property,n):o.setAttribute(u.component,n))}else this.el.setAttribute(e,n)}}},{key:"updatePhysics",value:function(t){t&&!this.isMine()&&(!this.lastPhysicsUpdateTimestamp||t.timestamp>this.lastPhysicsUpdateTimestamp)&&(t.hasConstraint&&NAF.options.useLerp?(NAF.physics.sleep(this.el),NAF.physics.attachPhysicsLerp(this.el,t)):(NAF.physics.detachPhysicsLerp(this.el),NAF.physics.wakeUp(this.el),NAF.physics.updatePhysics(this.el,t)),this.lastPhysicsUpdateTimestamp=t.timestamp)}},{key:"handlePhysicsCollision",value:function(t){if(this.isMine()){var e=NAF.physics.getDataFromCollision(t);e.el&&e.el.components["networked-share"]&&(NAF.physics.isStrongerThan(this.el,e.body)||""==e.el.components["networked-share"].data.owner)&&(e.el.components["networked-share"].takeOwnership(),NAF.log.write("Networked-Share: Inheriting ownership after collision to: ",e.el.id))}}},{key:"compressSyncData",value:function(t){var e=[];e.push(1),e.push(t.networkId),e.push(t.owner),e.push(t.parent),e.push(t.template);var n=this.compressComponents(t.components);return e.push(n),e}},{key:"compressComponents",value:function(t){for(var e={},n=this.getAllSyncedComponents(),u=0;u<n.length;u++){var o;o="string"==typeof n[u]?n[u]:naf.utils.childSchemaToKey(n[u]),t.hasOwnProperty(o)&&(e[u]=t[o])}return e}},{key:"decompressSyncData",value:function(t){var e={};e[0]=1,e.networkId=t[1],e.owner=t[2],e.parent=t[3],e.template=t[4];var n=t[5],u=this.decompressComponents(n);return e.components=u,e}},{key:"decompressComponents",value:function(t){var e={};for(var n in t){var u,o=this.data.components[n];u="string"==typeof o?o:naf.utils.childSchemaToKey(o),e[u]=t[n]}return e}},{key:"isSyncableComponent",value:function(t){if(naf.utils.isChildSchemaKey(t)){var e=naf.utils.keyToChildSchema(t);return this.hasThisChildSchema(e)}return this.data.components.indexOf(t)!=-1}},{key:"hasThisChildSchema",value:function(t){var e=this.data.components;for(var n in e){var u=e[n];if(naf.utils.childSchemaEqual(u,t))return!0}return!1}},{key:"updateCache",value:function(t){for(var e in t)this.cachedData[e]=t[e]}},{key:"remove",value:function(){var t={networkId:this.networkId};naf.connection.broadcastData("r",t)}}]),t}();t.exports=o},function(t,e,n){"use strict";function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var u=e[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}return function(e,n,u){return n&&t(e.prototype,n),u&&t(e,u),e}}(),i=n(4),r=function(){function t(e){u(this,t),this.entities=e,this.setupDefaultDCSubs(),this.connectList={},this.dcIsActive={},this.loggedIn=!1,this.onLoggedInEvent=new Event("loggedIn"),this.onPeerConnectedEvent=new Event("clientConnected"),this.onPeerDisconnectedEvent=new Event("clientDisconnected"),this.onDCOpenEvent=new Event("dataChannelOpened"),this.onDCCloseEvent=new Event("dataChannelClosed")}return o(t,[{key:"setNetworkInterface",value:function(t){this.network=t}},{key:"setupDefaultDCSubs",value:function(){this.dcSubscribers={u:this.entities.updateEntity.bind(this.entities),r:this.entities.removeRemoteEntity.bind(this.entities)}}},{key:"connect",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];NAF.app=t,NAF.room=e;var u={audio:n,video:!1,datachannel:!0};this.network.setStreamOptions(u),this.network.setDatachannelListeners(this.dcOpenListener.bind(this),this.dcCloseListener.bind(this),this.receiveDataChannelMessage.bind(this)),this.network.setLoginListeners(this.loginSuccess.bind(this),this.loginFailure.bind(this)),this.network.setRoomOccupantListener(this.occupantsReceived.bind(this)),this.network.joinRoom(e),this.network.connect(t)}},{key:"onLogin",value:function(t){this.loggedIn?t():document.body.addEventListener("loggedIn",t,!1)}},{key:"loginSuccess",value:function(t){NAF.log.write("Networked-Aframe Client ID:",t),NAF.clientId=t,this.loggedIn=!0,document.body.dispatchEvent(this.onLoggedInEvent)}},{key:"loginFailure",value:function(t,e){NAF.log.error(t,"failure to login"),this.loggedIn=!1}},{key:"occupantsReceived",value:function(t,e,n){this.checkForDisconnectingClients(this.connectList,e),this.connectList=e,this.checkForConnectingClients(e)}},{key:"checkForDisconnectingClients",value:function(t,e){for(var n in t){var u=e.hasOwnProperty(n);u||(NAF.log.write("Closing stream to ",n),this.network.closeStreamConnection(n),document.body.dispatchEvent(this.onPeerDisconnectedEvent))}}},{key:"checkForConnectingClients",value:function(t){for(var e in t){var n=this.isNewClient(e)&&this.network.shouldStartConnectionTo(t[e]);n&&(NAF.log.write("Opening stream to ",e),this.network.startStreamConnection(e),document.body.dispatchEvent(this.onPeerConnectedEvent))}}},{key:"isConnected",value:function(){return this.loggedIn}},{key:"isMineAndConnected",value:function(t){return NAF.clientId==t}},{key:"isNewClient",value:function(t){return!this.isConnectedTo(t)}},{key:"isConnectedTo",value:function(t){return this.network.getConnectStatus(t)===i.IS_CONNECTED}},{key:"dcOpenListener",value:function(t){NAF.log.write("Opened data channel from "+t),this.dcIsActive[t]=!0,this.entities.completeSync(),document.body.dispatchEvent(this.onDCOpenEvent)}},{key:"dcCloseListener",value:function(t){NAF.log.write("Closed data channel from "+t),this.dcIsActive[t]=!1,this.entities.removeEntitiesFromUser(t),document.body.dispatchEvent(this.onDCCloseEvent)}},{key:"dcIsConnectedTo",value:function(t){return this.dcIsActive.hasOwnProperty(t)&&this.dcIsActive[t]}},{key:"broadcastData",value:function(t,e,n){for(var u in this.connectList)this.sendData(u,t,e,n)}},{key:"broadcastDataGuaranteed",value:function(t,e){this.broadcastData(t,e,!0)}},{key:"sendData",value:function(t,e,n,u){this.dcIsConnectedTo(t)&&(u?this.network.sendDataGuaranteed(t,e,n):this.network.sendData(t,e,n))}},{key:"sendDataGuaranteed",value:function(t,e,n){this.sendData(t,e,n,!0)}},{key:"subscribeToDataChannel",value:function(t,e){return"u"==t||"r"==t?void NAF.log.error("NetworkConnection@subscribeToDataChannel: "+t+" is a reserved dataType. Choose another"):void(this.dcSubscribers[t]=e)}},{key:"unsubscribeFromDataChannel",value:function(t){return"u"==t||"r"==t?void NAF.log.error("NetworkConnection@unsubscribeFromDataChannel: "+t+" is a reserved dataType. Choose another"):void delete this.dcSubscribers[t]}},{key:"receiveDataChannelMessage",value:function(t,e,n){this.dcSubscribers.hasOwnProperty(e)?this.dcSubscribers[e](t,e,n):NAF.log.error("NetworkConnection@receiveDataChannelMessage: "+e+" has not been subscribed to yet. Call subscribeToDataChannel()")}}]),t}();t.exports=r},function(t,e,n){"use strict";function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var u=e[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}return function(e,n,u){return n&&t(e.prototype,n),u&&t(e,u),e}}(),i=n(50),r=function(){function t(){u(this,t),this.entities={},this.childCache=new i}return o(t,[{key:"registerLocalEntity",value:function(t,e){this.entities[t]=e}},{key:"createRemoteEntity",value:function(t){NAF.log.write("Creating remote entity",t);var e=document.createElement("a-entity");e.setAttribute("id","naf-"+t.networkId);var n=t.template,u=NAF.schemas.getComponents(n);return this.initPosition(e,t.components),this.initRotation(e,t.components),this.addNetworkComponent(e,t,u),this.entities[t.networkId]=e,e}},{key:"initPosition",value:function(t,e){var n=e.hasOwnProperty("position");if(n){var u=e.position;t.setAttribute("position",u)}}},{key:"initRotation",value:function(t,e){var n=e.hasOwnProperty("rotation");if(n){var u=e.rotation;t.setAttribute("rotation",u)}}},{key:"addNetworkComponent",value:function(t,e,n){var u={template:e.template,showTemplate:e.showTemplate,owner:e.owner,networkId:e.networkId,components:n};e.type&&"share"==e.type?t.setAttribute("networked-share",u):t.setAttribute("networked-remote",u),t.firstUpdateData=e}},{key:"updateEntity",value:function(t,e,n){var u=1==n[0],o=u?n[1]:n.networkId;this.hasEntity(o)?this.entities[o].emit("networkUpdate",{entityData:n},!1):u||this.receiveFirstUpdateFromEntity(n)}},{key:"receiveFirstUpdateFromEntity",value:function(t){var e=t.parent,n=t.networkId,u=e&&!this.hasEntity(e);if(u)this.childCache.addChild(e,t);else{var o=this.createRemoteEntity(t);this.createAndAppendChildren(n,o),this.addEntity(o,e)}}},{key:"createAndAppendChildren",value:function(t,e){for(var n=this.childCache.getChildren(t),u=0;u<n.length;u++){var o=this.createRemoteEntity(n[u]);e.appendChild(o)}}},{key:"addEntity",value:function(t,e){this.hasEntity(e)?this.addEntityToParent(t,e):this.addEntityToScene(t)}},{key:"addEntityToScene",value:function(t){var e=document.querySelector("a-scene");e.appendChild(t)}},{key:"addEntityToParent",value:function(t,e){var n=document.getElementById("naf-"+e);n.appendChild(t)}},{key:"completeSync",value:function(){for(var t in this.entities)this.entities.hasOwnProperty(t)&&this.entities[t].emit("syncAll",null,!1)}},{key:"removeRemoteEntity",value:function(t,e,n){var u=n.networkId;return this.removeEntity(u)}},{key:"removeEntitiesFromUser",value:function(t){var e=[];for(var n in this.entities){var u=NAF.utils.getNetworkOwner(this.entities[n]);if(u==t){var o=this.removeEntity(n);e.push(o)}}return e}},{key:"removeEntity",value:function(t){if(this.hasEntity(t)){var e=this.entities[t];return delete this.entities[t],e.parentNode.removeChild(e),e}return null}},{key:"getEntity",value:function(t){return this.entities.hasOwnProperty(t)?this.entities[t]:null}},{key:"hasEntity",value:function(t){return this.entities.hasOwnProperty(t)}}]),t}();t.exports=r},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var u=e[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}return function(e,n,u){return n&&t(e.prototype,n),u&&t(e,u),e}}(),o=function(){function t(){n(this,t),this.dict={}}return u(t,[{key:"add",value:function(t){this.validate(t)?this.dict[t.template]=t:(NAF.log.error("Schema not valid: ",t),NAF.log.error("See https://github.com/haydenjameslee/networked-aframe#syncing-custom-components"))}},{key:"hasTemplate",value:function(t){return this.dict.hasOwnProperty(t)}},{key:"getComponents",value:function(t){var e=["position","rotation"];return this.hasTemplate(t)&&(e=this.dict[t].components),e}},{key:"validate",value:function(t){return t.hasOwnProperty("template")&&t.hasOwnProperty("components")}},{key:"remove",value:function(t){delete this.dict[t]}},{key:"clear",value:function(){this.dict={}}}]),t}();t.exports=o},function(t,e,n){"use strict";var u=n(1);AFRAME.registerComponent("networked-remote",{schema:{template:{default:""},showTemplate:{default:!0},networkId:{default:""},owner:{default:""},components:{default:["position","rotation"]}},init:function(){this.networkComponents=new NetworkComponents(this.el,this.data),this.attachTemplate(this.data.template,this.data.showTemplate),this.attachLerp(),this.el.firstUpdateData&&this.firstUpdate()},update:function(t){this.networkComponents.setData(this.data)},attachTemplate:function(t,e){if(e){var n=document.createElement("a-entity");n.setAttribute("template","src:"+t),this.el.appendChild(n)}},attachLerp:function(){u.options.useLerp&&this.el.setAttribute("lerp","")},firstUpdate:function(){var t=this.el.firstUpdateData;this.networkUpdate(t),this.waitForTemplateAndUpdateChildren()},waitForTemplateAndUpdateChildren:function(){var t=this,e=function(){var e=t.el.firstUpdateData;t.networkUpdate(e)};setTimeout(e,50)},play:function(){this.bindEvents()},bindEvents:function(){this.el.addEventListener("networkUpdate",this.networkComponents.networkUpdateHandler.bind(this.networkComponents))},pause:function(){this.unbindEvents()},unbindEvents:function(){this.el.removeEventListener("networkUpdate",this.networkComponents.networkUpdateHandler)}})},function(t,e,n){"use strict";var u=n(1),o=n(64),i=n(66),r=n(65);AFRAME.registerComponent("networked-scene",{schema:{app:{default:"default"},room:{default:"default"},connectOnLoad:{default:!0},signalURL:{default:"/"},onConnect:{default:"onConnect"},webrtc:{default:!1},webrtcAudio:{default:!1},firebase:{default:!1},firebaseApiKey:{default:""},firebaseAuthType:{default:"none",oneOf:["none","anonymous"]},firebaseAuthDomain:{default:""},firebaseDatabaseURL:{default:""},debug:{default:!1},updateRate:{default:0},useLerp:{default:!0},compressSyncPackets:{default:!1}},init:function(){this.data.updateRate&&(u.options.updateRate=this.data.updateRate),u.options.useLerp=this.data.useLerp,u.options.compressSyncPackets=this.data.compressSyncPackets,this.el.addEventListener("connect",this.connect.bind(this)),this.data.connectOnLoad&&this.el.emit("connect",null,!1)},connect:function(){u.log.setDebug(this.data.debug),u.log.write("Networked-Aframe Connecting..."),this.checkDeprecatedProperties(),this.setupNetworkInterface(),this.hasOnConnectFunction()&&this.callOnConnect(),u.connection.connect(this.data.app,this.data.room,this.data.webrtcAudio)},checkDeprecatedProperties:function(){},setupNetworkInterface:function(){var t;if(this.data.webrtc)if(this.data.firebase){var e=new r(firebase,{authType:this.data.firebaseAuthType,apiKey:this.data.firebaseApiKey,authDomain:this.data.firebaseAuthDomain,databaseURL:this.data.firebaseDatabaseURL});t=e}else{var n=new o(easyrtc);n.setSignalUrl(this.data.signalURL),t=n}else{var s=new i(easyrtc);s.setSignalUrl(this.data.signalURL),t=s,this.data.webrtcAudio&&u.log.error("networked-scene: webrtcAudio option will only be used if webrtc is set to true. webrtc is currently false")}u.connection.setNetworkInterface(t)},hasOnConnectFunction:function(){return""!=this.data.onConnect&&window.hasOwnProperty(this.data.onConnect)},callOnConnect:function(){u.connection.onLogin(window[this.data.onConnect])}})},function(t,e,n){"use strict";var u=n(1);n(7);AFRAME.registerComponent("networked-share",{schema:{template:{default:""},networkId:{default:""},owner:{default:""},takeOwnershipEvents:{type:"array",default:["grabbed","touched"]},removeOwnershipEvents:{type:"array",default:[]},components:{default:["position","rotation"]},physics:{default:!1}},init:function(){this.networkComponents=new NetworkComponents(this.el,this.data),this.networkUpdateHandler=this.networkUpdateHandler.bind(this),this.networkComponents.syncDirty=this.networkComponents.syncDirty.bind(this.networkComponents),this.networkComponents.syncAll=this.networkComponents.syncAll.bind(this.networkComponents),this.takeOwnership=this.takeOwnership.bind(this),this.removeOwnership=this.removeOwnership.bind(this),this.networkComponents.handlePhysicsCollision=this.networkComponents.handlePhysicsCollision.bind(this.networkComponents),this.attachTemplate(this.data.template),this.networkComponents.checkLoggedIn(),this.el.firstUpdateData&&this.firstUpdate(),this.takeover=!1},attachAndShowTemplate:function(t,e){},firstUpdate:function(){var t=this.el.firstUpdateData;this.networkComponents.networkUpdate(t),this.waitForTemplateAndUpdateChildren()},waitForTemplateAndUpdateChildren:function(){var t=this,e=function(){var e=t.el.firstUpdateData;t.networkComponents.networkUpdate(e)};setTimeout(e,50)},update:function(){this.data.physics?this.el.addEventListener(NAF.physics.collisionEvent,this.networkComponents.handlePhysicsCollision):this.el.removeEventListener(NAF.physics.collisionEvent,this.networkComponents.handlePhysicsCollision),this.lastPhysicsUpdateTimestamp=null},takeOwnership:function(){this.networkComponents.isMine()||(this.unbindOwnerEvents(),this.unbindRemoteEvents(),this.data.owner=NAF.clientId,this.networkComponents.setOwner(this.data.owner),this.data.physics?(NAF.physics.detachPhysicsLerp(this.el),NAF.physics.wakeUp(this.el)):this.detachLerp(),this.el.emit("networked-ownership-taken"),this.takeover=!0,this.networkComponents.syncAll(),this.takeover=!1,this.bindOwnerEvents(),this.bindRemoteEvents(),NAF.log.write("Networked-Share: Taken ownership of ",this.el.id))},removeOwnership:function(){this.networkComponents.isMine()&&(this.unbindOwnerEvents(),this.unbindRemoteEvents(),this.data.owner="",this.networkComponents.setOwner(this.data.owner),this.bindRemoteEvents(),this.data.physics||this.attachLerp(),this.el.emit("networked-ownership-removed"),this.networkComponents.syncAll(),NAF.log.write("Networked-Share: Removed ownership of ",this.el.id))},updateOwnership:function(t,e){var n=!(this.data.owner==t),u=NAF.clientId==t;this.networkComponents.isMine()&&!u&&n&&e?(this.unbindOwnerEvents(),this.unbindRemoteEvents(),this.data.owner=t,this.networkComponents.setOwner(this.data.owner),this.bindRemoteEvents(),this.data.physics||this.attachLerp(),this.el.emit("networked-ownership-lost"),NAF.log.write("Networked-Share: Friendly takeover of: "+this.el.id+" by ",this.data.owner)):!this.networkComponents.isMine()&&n&&(this.data.owner=t,this.networkComponents.setOwner(this.data.owner),this.el.emit("networked-ownership-changed"),NAF.log.write("Networked-Share: Updated owner of: "+this.el.id+" to ",this.data.owner))},attachLerp:function(){u.options.useLerp&&this.el.setAttribute("lerp","")},detachLerp:function(){u.options.useLerp&&this.el.removeAttribute("lerp")},play:function(){this.bindOwnershipEvents(),this.bindRemoteEvents()},bindOwnershipEvents:function(){if(this.data.takeOwnershipEvents)for(var t=0;t<this.data.takeOwnershipEvents.length;t++)this.el.addEventListener(this.data.takeOwnershipEvents[t],this.takeOwnership);if(this.data.removeOwnershipEvents)for(var t=0;t<this.data.removeOwnershipEvents.length;t++)this.el.addEventListener(this.data.removeOwnershipEvents[t],this.removeOwnership)},bindRemoteEvents:function(){this.el.addEventListener("networkUpdate",this.networkUpdateHandler)},bindOwnerEvents:function(){this.el.addEventListener("sync",this.networkComponents.syncDirty),this.el.addEventListener("syncAll",this.networkComponents.syncAll)},pause:function(){this.unbindOwnershipEvents(),this.unbindRemoteEvents()},unbindOwnershipEvents:function(){if(this.data.takeOwnershipEvents)for(var t=0;t<this.data.takeOwnershipEvents.length;t++)this.el.removeEventListener(this.data.takeOwnershipEvents[t],this.takeOwnership);if(this.data.removeOwnershipEvents)for(var t=0;t<this.data.removeOwnershipEvents.length;t++)this.el.removeEventListener(this.data.removeOwnershipEvents[t],this.removeOwnership)},unbindRemoteEvents:function(){this.el.removeEventListener("networkUpdate",this.networkUpdateHandler)},unbindOwnerEvents:function(){this.el.removeEventListener("sync",this.networkComponents.syncDirty),this.el.removeEventListener("syncAll",this.networkComponents.syncAll)},tick:function(){this.networkComponents.isMine()&&this.networkComponents.needsToSync()&&this.networkComponents.syncDirty()},networkUpdate:function(t){var e;1==t[0]&&(e=this.decompressSyncData(t)),this.updateOwnership(e.owner,e.takeover),this.networkComponents.networkUpdateHandler(t)},remove:function(){this.removeOwnership(),this.networkComponents.remove(),this.unbindOwnershipEvents(),this.unbindOwnerEvents(),this.unbindRemoteEvents()}})},function(t,e,n){"use strict";var u=(n(1),n(7),n(56));AFRAME.registerComponent("networked",{schema:{template:{default:""},showLocalTemplate:{default:!0},showRemoteTemplate:{default:!0},physics:{default:!1}},init:function(){this.networkComponents=new u(this.el,this.data),this.attachAndShowTemplate(this.data.template,this.data.showLocalTemplate),this.networkComponents.checkLoggedIn()},update:function(t){this.networkComponents.setData(this.data)},attachAndShowTemplate:function(t,e){if(this.templateEl&&this.el.removeChild(this.templateEl),t){var n=document.createElement("a-entity");n.setAttribute("template","src:"+t),n.setAttribute("visible",e),this.el.appendChild(n),this.templateEl=n}},play:function(){this.bindEvents()},bindEvents:function(){this.el.addEventListener("sync",this.networkComponents.syncDirty.bind(this.networkComponents)),this.el.addEventListener("syncAll",this.networkComponents.syncAll.bind(this.networkComponents))},pause:function(){this.unbindEvents()},unbindEvents:function(){this.el.removeEventListener("sync",this.networkComponents.syncDirty),this.el.removeEventListener("syncAll",this.networkComponents.syncAll)},tick:function(){this.networkComponents.needsToSync()&&this.networkComponents.syncDirty()},remove:function(){this.networkComponents.remove()}})},function(t,e,n){"use strict";function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var u=e[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}return function(e,n,u){return n&&t(e.prototype,n),u&&t(e,u),e}}(),s=n(1),a=n(4),c=function(t){function e(t){u(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.easyrtc=t,n}return i(e,t),r(e,[{key:"setSignalUrl",value:function(t){this.easyrtc.setSocketUrl(t)}},{key:"joinRoom",value:function(t){this.easyrtc.joinRoom(t,null)}},{key:"setRoomOccupantListener",value:function(t){this.easyrtc.setRoomOccupantListener(t);
}},{key:"setStreamOptions",value:function(t){this.easyrtc.enableDataChannels(t.datachannel),this.easyrtc.enableVideo(!1),this.easyrtc.enableAudio(t.audio),this.easyrtc.enableVideoReceive(!1),this.easyrtc.enableAudioReceive(t.audio)}},{key:"setDatachannelListeners",value:function(t,e,n){this.easyrtc.setDataChannelOpenListener(t),this.easyrtc.setDataChannelCloseListener(e),this.easyrtc.setPeerListener(n)}},{key:"setLoginListeners",value:function(t,e){this.loginSuccess=t,this.loginFailure=e}},{key:"connect",value:function(t){var e=this,n=function(t){e.myRoomJoinTime=e.getRoomJoinTime(t),e.loginSuccess(t)};this.easyrtc.audioEnabled?this.connectWithAudio(t,n,this.loginFailure):this.easyrtc.connect(t,n,this.loginFailure)}},{key:"connectWithAudio",value:function(t,e,n){var u=this;this.easyrtc.setStreamAcceptor(function(t,e){var n=document.createElement("audio");n.setAttribute("id","audio-"+t),document.body.appendChild(n),u.easyrtc.setVideoObjectSrc(n,e)}),this.easyrtc.setOnStreamClosed(function(t){var e=document.getElementById("audio-"+t);e.parentNode.removeChild(e)}),this.easyrtc.initMediaSource(function(){u.easyrtc.connect(t,e,n)},function(t,e){console.error(t,e)})}},{key:"shouldStartConnectionTo",value:function(t){return this.myRoomJoinTime<=t.roomJoinTime}},{key:"startStreamConnection",value:function(t){this.easyrtc.call(t,function(t,e){"datachannel"===e&&s.log.write("Successfully started datachannel to ",t)},function(t,e){console.error(t,e)},function(t){})}},{key:"closeStreamConnection",value:function(t){}},{key:"sendData",value:function(t,e,n){this.easyrtc.sendDataP2P(t,e,n)}},{key:"sendDataGuaranteed",value:function(t,e,n){this.easyrtc.sendDataWS(t,e,n)}},{key:"getRoomJoinTime",value:function(t){var e=s.room,n=easyrtc.getRoomOccupantsAsMap(e)[t].roomJoinTime;return n}},{key:"getConnectStatus",value:function(t){var e=this.easyrtc.getConnectStatus(t);return e==this.easyrtc.IS_CONNECTED?a.IS_CONNECTED:e==this.easyrtc.NOT_CONNECTED?a.NOT_CONNECTED:a.CONNECTING}}]),e}(a);t.exports=c},function(t,e,n){"use strict";function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var u=e[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}return function(e,n,u){return n&&t(e.prototype,n),u&&t(e,u),e}}(),s=(n(1),n(4)),a=function(t){function e(t,n){if(u(this,e),void 0===t)throw new Error("Import https://www.gstatic.com/firebasejs/x.x.x/firebase.js");var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.rootPath="networked-aframe",i.id=null,i.appId=null,i.roomId=null,i.peers={},i.occupants={},i.firebase=t,i.authType=n.authType,i.apiKey=n.apiKey,i.authDomain=n.authDomain,i.databaseURL=n.databaseURL,i}return i(e,t),r(e,[{key:"joinRoom",value:function(t){this.roomId=t}},{key:"setRoomOccupantListener",value:function(t){this.occupantListener=t}},{key:"setStreamOptions",value:function(t){t.datachannel===!1&&console.warn("FirebaseWebRtcInterface.setStreamOptions: datachannel must be true."),t.audio===!0&&console.warn("FirebaseWebRtcInterface does not support audio yet."),t.video===!0&&console.warn("FirebaseWebRtcInterface does not support video yet.")}},{key:"setDatachannelListeners",value:function(t,e,n){this.openListener=t,this.closedListener=e,this.messageListener=n}},{key:"setLoginListeners",value:function(t,e){this.loginSuccess=t,this.loginFailure=e}},{key:"connect",value:function(t){var e=this,n=this.firebase;this.appId=t,this.initFirebase(function(t){e.id=t,e.getTimestamp(function(t){e.myRoomJoinTime=t;var u=n.database().ref(e.getUserPath(e.id));u.set({timestamp:t,signal:"",data:""}),u.onDisconnect().remove();var o=n.database().ref(e.getRoomPath());o.on("child_added",function(u){var o=u.key;if(o!==e.id&&"timestamp"!==o&&void 0===e.peers[o]){var i=u.val().timestamp,r=new c(e.id,o,function(t){n.database().ref(e.getSignalPath(e.id)).set(t)});r.setDatachannelListeners(e.openListener,e.closedListener,e.messageListener),e.peers[o]=r,e.occupants[o]=i,n.database().ref(e.getSignalPath(o)).on("value",function(t){var e=t.val();null!==e&&""!==e&&r.handleSignal(e)}),n.database().ref(e.getDataPath(o)).on("value",function(t){var n=t.val();null!==n&&""!==n&&n.to===e.id&&e.messageListener(o,n.type,n.data)}),(t>i||t===i&&e.id>o)&&r.offer(),e.occupantListener(e.roomId,e.occupants,!1)}}),o.on("child_removed",function(t){var n=t.key;n!==e.id&&"timestamp"!==n&&void 0!==e.peers[n]&&(delete e.peers[n],delete e.occupants[n],e.occupantListener(e.roomId,e.occupants,!1))}),e.loginSuccess(e.id)})})}},{key:"shouldStartConnectionTo",value:function(t){return(this.myRoomJoinTime||0)<=(t?t.roomJoinTime:0)}},{key:"startStreamConnection",value:function(t){console.warn("FirebaseWebRtcInterface does not imlement startStreamConnectionMethod yet.")}},{key:"closeStreamConnection",value:function(t){console.warn("FirebaseWebRtcInterface does not imlement closeStreamConnectionMethod yet.")}},{key:"sendData",value:function(t,e,n){this.peers[t].send(e,n)}},{key:"sendDataGuaranteed",value:function(t,e,n){void 0===n.takeover&&(n.takeover=null),this.firebase.database().ref(this.getDataPath(this.id)).set({to:t,type:e,data:n})}},{key:"getRoomJoinTime",value:function(t){return this.occupants[t]}},{key:"getConnectStatus",value:function(t){var e=this.peers[t];if(void 0===e)return s.NOT_CONNECTED;switch(e.getStatus()){case c.IS_CONNECTED:return s.IS_CONNECTED;case c.CONNECTING:return s.CONNECTING;case c.NOT_CONNECTED:default:return s.NOT_CONNECTED}}},{key:"initFirebase",value:function(t){this.firebase.initializeApp({apiKey:this.apiKey,authDomain:this.authDomain,databaseURL:this.databaseURL}),this.auth(this.authType,t)}},{key:"auth",value:function(t,e){switch(t){case"none":this.authNone(e);break;case"anonymous":this.authAnonymous(e);break;default:console.log("FirebaseWebRtcInterface.auth: Unknown authType "+t)}}},{key:"authNone",value:function(t){var e=this;requestAnimationFrame(function(){t(e.randomString())})}},{key:"authAnonymous",value:function(t){var e=this,n=this.firebase;n.auth().signInAnonymously().catch(function(t){console.error("FirebaseWebRtcInterface.authAnonymous: "+t),e.loginFailure(null,t)}),n.auth().onAuthStateChanged(function(e){null!==e&&t(e.uid)})}},{key:"getRootPath",value:function(){return this.rootPath}},{key:"getAppPath",value:function(){return this.getRootPath()+"/"+this.appId}},{key:"getRoomPath",value:function(){return this.getAppPath()+"/"+this.roomId}},{key:"getUserPath",value:function(t){return this.getRoomPath()+"/"+t}},{key:"getSignalPath",value:function(t){return this.getUserPath(t)+"/signal"}},{key:"getDataPath",value:function(t){return this.getUserPath(t)+"/data"}},{key:"getTimestampGenerationPath",value:function(t){return this.getRoomPath()+"/timestamp/"+t}},{key:"randomString",value:function(){for(var t=16,e="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz0123456789",n="",u=0;u<t;u++){var o=Math.floor(Math.random()*e.length);n+=e.substring(o,o+1)}return n}},{key:"getTimestamp",value:function(t){var e=this.firebase,n=e.database().ref(this.getTimestampGenerationPath(this.id));n.set(e.database.ServerValue.TIMESTAMP),n.once("value",function(e){var u=e.val();n.remove(),t(u)}),n.onDisconnect().remove()}}]),e}(s);t.exports=a;var c=function(){function t(e,n,o){u(this,t),this.localId=e,this.remoteId=n,this.sendSignalFunc=o,this.open=!1,this.channelLabel="networked-aframe-channel",this.pc=this.createPeerConnection(),this.channel=null}return r(t,[{key:"setDatachannelListeners",value:function(t,e,n){this.openListener=t,this.closedListener=e,this.messageListener=n}},{key:"offer",value:function(){var t=this;this.setupChannel(this.pc.createDataChannel(this.channelLabel,{reliable:!1})),this.pc.createOffer(function(e){t.handleSessionDescription(e)},function(t){console.error("WebRtcPeer.offer: "+t)})}},{key:"handleSignal",value:function(t){if(this.localId===t.to&&this.remoteId===t.from)switch(t.type){case"offer":this.handleOffer(t);break;case"answer":this.handleAnswer(t);break;case"candidate":this.handleCandidate(t);break;default:console.error("WebRtcPeer.handleSignal: Unknown signal type "+t.type)}}},{key:"send",value:function(t,e){null!==this.channel&&"open"===this.channel.readyState&&this.channel.send(JSON.stringify({type:t,data:e}))}},{key:"getStatus",value:function(){if(null===this.channel)return t.NOT_CONNECTED;switch(this.channel.readyState){case"open":return t.IS_CONNECTED;case"connecting":return t.CONNECTING;case"closing":case"closed":default:return t.NOT_CONNECTED}}},{key:"createPeerConnection",value:function(){var e=this,n=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection;if(void 0===n)throw new Error("WebRtcPeer.createPeerConnection: This browser does not seem to support WebRTC.");var u=new n({iceServers:t.ICE_SERVERS});return u.onicecandidate=function(t){t.candidate&&e.sendSignalFunc({from:e.localId,to:e.remoteId,type:"candidate",sdpMLineIndex:t.candidate.sdpMLineIndex,candidate:t.candidate.candidate})},u.oniceconnectionstatechange=function(){e.open&&"disconnected"===u.iceConnectionState&&(e.open=!1)},u}},{key:"setupChannel",value:function(t){var e=this;this.channel=t,this.channel.onmessage=function(t){var n=JSON.parse(t.data);e.messageListener(e.remoteId,n.type,n.data)},this.channel.onopen=function(t){e.open=!0,e.openListener(e.remoteId)},this.channel.onclose=function(t){e.open&&(e.open=!1,e.closedListener(e.remoteId))},this.channel.onerror=function(t){console.error("WebRtcPeer.channel.onerror: "+t)}}},{key:"handleOffer",value:function(t){var e=this;this.pc.ondatachannel=function(t){e.setupChannel(t.channel)},this.setRemoteDescription(t),this.pc.createAnswer(function(t){e.handleSessionDescription(t)},function(t){console.error("WebRtcPeer.handleOffer: "+t)})}},{key:"handleAnswer",value:function(t){this.setRemoteDescription(t)}},{key:"handleCandidate",value:function(t){var e=window.RTCIceCandidate||window.webkitRTCIceCandidate||window.mozRTCIceCandidate;this.pc.addIceCandidate(new e(t),function(){},function(t){console.error("WebRtcPeer.handleCandidate: "+t)})}},{key:"handleSessionDescription",value:function(t){this.pc.setLocalDescription(t,function(){},function(t){console.error("WebRtcPeer.handleSessionDescription: "+t)}),this.sendSignalFunc({from:this.localId,to:this.remoteId,type:t.type,sdp:t.sdp})}},{key:"setRemoteDescription",value:function(t){var e=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription||window.msRTCSessionDescription;this.pc.setRemoteDescription(new e(t),function(){},function(t){console.error("WebRtcPeer.setRemoteDescription: "+t)})}}]),t}();c.IS_CONNECTED="IS_CONNECTED",c.CONNECTING="CONNECTING",c.NOT_CONNECTED="NOT_CONNECTED",c.ICE_SERVERS=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]},function(t,e,n){"use strict";function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var u=e[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}return function(e,n,u){return n&&t(e.prototype,n),u&&t(e,u),e}}(),s=n(1),a=n(4),c=function(t){function e(t){u(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.easyrtc=t,n.connectedClients=[],n}return i(e,t),r(e,[{key:"setSignalUrl",value:function(t){this.easyrtc.setSocketUrl(t)}},{key:"joinRoom",value:function(t){this.easyrtc.joinRoom(t,null)}},{key:"setRoomOccupantListener",value:function(t){this.easyrtc.setRoomOccupantListener(t)}},{key:"setStreamOptions",value:function(t){}},{key:"setDatachannelListeners",value:function(t,e,n){this.openListener=t,this.closedListener=e,this.easyrtc.setPeerListener(n)}},{key:"setLoginListeners",value:function(t,e){this.loginSuccess=t,this.loginFailure=e}},{key:"connect",value:function(t){this.easyrtc.connect(t,this.loginSuccess,this.loginFailure)}},{key:"shouldStartConnectionTo",value:function(t){return!0}},{key:"startStreamConnection",value:function(t){this.connectedClients.push(t),this.openListener(t)}},{key:"closeStreamConnection",value:function(t){var e=this.connectedClients.indexOf(t);e>-1&&this.connectedClients.splice(e,1),this.closedListener(t)}},{key:"sendData",value:function(t,e,n){this.easyrtc.sendDataWS(t,e,n)}},{key:"sendDataGuaranteed",value:function(t,e,n){this.sendData(t,e,n)}},{key:"getRoomJoinTime",value:function(t){var e=s.room,n=easyrtc.getRoomOccupantsAsMap(e)[t].roomJoinTime;return n}},{key:"getConnectStatus",value:function(t){var e=this.connectedClients.indexOf(t)!=-1;return e?a.IS_CONNECTED:a.NOT_CONNECTED}}]),e}(a);t.exports=c}]);